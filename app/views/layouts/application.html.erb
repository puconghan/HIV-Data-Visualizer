<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>HIV World Prevalence</title>
  <%= stylesheet_link_tag 'main_style.css' %>
  <%= stylesheet_link_tag 'jquery-ui.css' %>
  <script src="http://code.jquery.com/jquery-1.8.2.js"></script>
  <script src="http://code.jquery.com/ui/1.9.1/jquery-ui.js"></script>
  <script> $(function() { $( "#tabs" ).tabs(); }); </script>
  <script> $(function() { $( "#selectable" ).selectable(); }); </script>
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <script type="text/javascript">
    google.load('visualization', '1', {packages: ['geomap']});
    google.load('search', '1');

    $(function() {
      $.getJSON('http://127.0.0.1:3000/hivdatafetcher.json', function(data) {        
          var map = new google.visualization.DataTable();
          map.addColumn('string', 'Country');
          map.addColumn('number', 'HIV Prevalence');
          map.addColumn('string', 'Description');
            
          $.each(data, function(i,v) {
		 map.addRow([v.name, parseFloat(v.value), v.displayname]);
          });

          var geomap = new google.visualization.GeoMap(
            document.getElementById('visualization'));
          geomap.draw(map, null);
      });
   });

   var newsSearch;
   function searchComplete() {
        if (newsSearch.results && newsSearch.results.length > 0) {
            for (var i = 0; i < newsSearch.results.length; i++) {
                    var tr = document.createElement('tr');
                    
                    var p = document.createElement('p');
                    var a = document.createElement('a');
                    a.href= newsSearch.results[i].unescapedUrl;
                    a.innerHTML = newsSearch.results[i].title;
                    p.appendChild(a);
                    tr.appendChild(p);
                    
                    if(newsSearch.results[i].image != undefined){
                        var divOut = document.createElement('div');
                        divOut.setAttribute('class', 'fr_img');
                        var div = document.createElement('div');
                        div.setAttribute('class', 'image_wrapper');
                        var aimg = document.createElement('a');
                        aimg.href = newsSearch.results[i].unescapedUrl;
                        var img = document.createElement('img');
                        img.src = newsSearch.results[i].image.url;
                        img.border = 0;
                        img.width = 30;
                        img.height = 30;
                        aimg.appendChild(img);
                        div.appendChild(aimg);
                        divOut.appendChild(div);
                        p.appendChild(divOut);
                    }

                    $('#googleNews_content').append(tr);
            }
        }
   }

   function onLoad() {
         newsSearch = new google.search.NewsSearch();
        newsSearch.setSearchCompleteCallback(this, searchComplete, null);
        newsSearch.execute('HIV AIDS');
        google.search.Search.getBranding('branding');
        
   }

   google.setOnLoadCallback(onLoad);

    /* Youtube Vedio */
    $(document).ready(function(){
        keywords = "HIV/" + "world";
        var doc = {};

        suc_fun = function(doc){
            entries = doc.getElementsByTagName('feed')[0].getElementsByTagName('entry');
            console.log(entries);
            console.log(entries.length);
            console.log(entries[0]);
            for(var i=0; i<= 3 && i<entries.length; i++){
                console.log(entries[i]);
                /*
                title = entries[i].getElementsByTagName('title')[0].getElementsByTagName('title')[0].textContent;
                console.log(title);
                /*title = entries[i].getElementsByTagName('title')[0].toString();
                console.log(title);
            */
                /*console.log(entries[i]);
                */
                title = entries[i].getElementsByTagName('title')[0].textContent;
                /*console.log(title);
                */
                url = entries[i].getElementsByTagName('content')[0].getAttribute('src');
                /*console.log(url);
                */
                time = entries[i].getElementsByTagName('published')[0].textContent;
                time = time.substring(0, 10);
                /*console.log(time);
                */
                var p = document.createElement('p');
                var a = document.createElement('a');
                var pp = document.createElement('p');
                a.href= url;
                a.innerHTML = title;
                a.target = '_blank';
                pp.innerHTML = time;
                p.appendChild(a);
                p.appendChild(pp);
                $('#youtubeVideos_content').append(p);
            }
            /*$('#youtubeVideos_content').append();
            */
    
        };

        fail_fun = function(ret){
        };
        
        $.ajax({
            url: "https://gdata.youtube.com/feeds/api/videos/-/" + keywords + "?v=2",
            type: 'GET',
            async: false
        }).success(suc_fun).fail(fail_fun);
    
    });

</script>
</head>

<body>
<div id="templatemo_wrapper">
	<div id="templatemo_header">

        <div id="templatemo_menu">
            <ul>
                <li><%= link_to "Home", root_path %></li>
                <li><a href="data.html">Data</a></li>
                <li><a href="stories.html">Stories</a></li>
                <li><a href="contact.html">Contact</a></li>
                <div id="user_nav">
    			<% if user_signed_in? %>
    				<% if current_user.priority == "low" %>
        				<li><%= link_to "Log out", destroy_user_session_path, :method => :delete %></li>
        			<% else %>
        				<li><%=link_to "Manage User", manage_user_path %></li>
        				<li><%= link_to "Log out", destroy_user_session_path, :method => :delete %></li>
        			<% end %>
    			<% else %>
        			<li><%= link_to 'Sign Up', new_user_registration_path %></li>
        			<li><%= link_to 'Sign in', new_user_session_path %></li>
				<% end %>
</div>
            </ul>    	    
        </div> 
        
        <div id="site_title">
          <h1><a href="index.html" target="_parent">Global <strong>HIV</strong><span>Prevalence Overview</span></a></h1>            
        </div>
    </div>
    

	
</div> 

<%= yield %>

<div id="templatemo_wrapper">
	<div id="templatemo_footer">
		<script charset="utf-8" src="http://widgets.twimg.com/j/2/widget.js"></script>
		<script>
			new TWTR.Widget({
				version: 2,type: 'search',search: '#HIV',interval: 3000,title: '',subject: '#HIV',width: 900, height: 200,
				theme: {shell: {background: '#1d1400',color: '#ffffff'},tweets: {background: '#c5bba4',color: '#f9f8f5',links: '#1d1400'}},
				features: { scrollbar: false, loop: true, live: true, behavior: 'default'}}).render().start();
		</script>
		Copyright Â© 2012 | Network Fetcher | <a href= "http://score-contest.org/2013/"> Student Contest on Software Engineering </a>    
	</div>
</div>
</body>
</html>
